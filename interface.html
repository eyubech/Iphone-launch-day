<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPhone Order Bot - Control Panel</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .control-panel {
            padding: 40px;
        }

        .status-bar {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #dc3545;
            animation: pulse 2s infinite;
        }

        .status-dot.active {
            background: #28a745;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .form-section {
            margin-bottom: 35px;
        }

        .section-title {
            font-size: 1.4em;
            color: #2d3748;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        input {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        input:hover {
            border-color: #cbd5e0;
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        button {
            padding: 15px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(40, 167, 69, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: white;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(255, 193, 7, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(220, 53, 69, 0.3);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
            transform: translateY(-2px);
        }

        .logs-container {
            margin-top: 30px;
            padding: 20px;
            background: #1a202c;
            border-radius: 12px;
            color: #e2e8f0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid #2d3748;
        }

        .logs-header {
            color: #667eea;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-entry.info {
            color: #63b3ed;
        }

        .log-entry.success {
            color: #68d391;
        }

        .log-entry.warning {
            color: #fbd38d;
        }

        .log-entry.error {
            color: #fc8181;
        }

        .warning-box {
            background: linear-gradient(135deg, #fed7d7 0%, #fbb6ce 100%);
            border: 2px solid #feb2b2;
            color: #9b2c2c;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            font-weight: 500;
        }

        .warning-box strong {
            display: block;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .button-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }

            .status-bar {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçé iPhone Order Bot</h1>
            <p>Tampermonkey Script Configuration & Control Panel</p>
        </div>

        <div class="control-panel">
            <div class="status-bar">
                <div class="status-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Script Status: Not Connected</span>
                </div>
                <div id="currentUrl">No URL detected</div>
            </div>

            <div class="status-bar">
                <div class="status-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Script Status: Not Connected</span>
                </div>
                <div id="currentUrl">No URL detected</div>
            </div>

            <div class="form-section">
                <h2 class="section-title">üîó Navigation Control</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="targetUrl">Target URL:</label>
                        <input type="url" id="targetUrl" placeholder="https://www.apple.com/iphone/" />
                    </div>
                    <div class="form-group">
                        <label for="deliveryDate">Expected Delivery Date:</label>
                        <input type="text" id="deliveryDate" placeholder="Sep 19" />
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">üë§ Personal Information</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="firstName">First Name:</label>
                        <input type="text" id="firstName" value="test" />
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name:</label>
                        <input type="text" id="lastName" value="test" />
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address:</label>
                        <input type="email" id="email" value="test@example.com" />
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number:</label>
                        <input type="tel" id="phone" value="1234567890" />
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">üè† Address Information</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label for="streetAddress">Street Address:</label>
                        <input type="text" id="streetAddress" value="2934 NW 72nd Ave" />
                    </div>
                    <div class="form-group">
                        <label for="postalCode">Postal/ZIP Code:</label>
                        <input type="text" id="postalCode" value="33122" />
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title">üí≥ Payment Information</h2>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label for="cardNumber">Card Number:</label>
                        <input type="text" id="cardNumber" value="4111111111111111" placeholder="Test card number" />
                    </div>
                    <div class="form-group">
                        <label for="expirationDate">Expiration (MMYY):</label>
                        <input type="text" id="expirationDate" value="0426" placeholder="0426" />
                    </div>
                    <div class="form-group">
                        <label for="securityCode">CVV:</label>
                        <input type="text" id="securityCode" value="123" placeholder="123" />
                    </div>
                </div>
            </div>

            <div class="button-grid">
                <button class="btn-primary" onclick="saveConfiguration()">üíæ Save Config</button>
                <button class="btn-success" onclick="startBot()">üöÄ Start Bot</button>
                <button class="btn-warning" onclick="testConnection()">üîó Test Link</button>
                <button class="btn-danger" onclick="stopBot()">‚õî Stop Bot</button>
                <button class="btn-secondary" onclick="resetConfiguration()">üîÑ Reset</button>
                <button class="btn-secondary" onclick="navigateToUrl()">üåê Go to URL</button>
            </div>

            <div class="logs-container">
                <div class="logs-header">üìã Activity Logs</div>
                <div id="logContainer">
                    <div class="log-entry info">[INFO] Control panel loaded successfully</div>
                    <div class="log-entry info">[INFO] Waiting for configuration...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isScriptActive = false;
        let botRunning = false;

        // Logging function
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // Keep only last 20 logs
            while (logContainer.children.length > 20) {
                logContainer.removeChild(logContainer.firstChild);
            }
        }

        // Save configuration to localStorage
        function saveConfiguration() {
            const config = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                streetAddress: document.getElementById('streetAddress').value,
                postalCode: document.getElementById('postalCode').value,
                cardNumber: document.getElementById('cardNumber').value,
                expirationDate: document.getElementById('expirationDate').value,
                securityCode: document.getElementById('securityCode').value,
                targetUrl: document.getElementById('targetUrl').value,
                deliveryDate: document.getElementById('deliveryDate').value
            };

            localStorage.setItem('iphoneBotConfig', JSON.stringify(config));
            addLog('Configuration saved successfully', 'success');
            updateStatus(true, 'Configuration Saved');
        }

        // Load configuration from localStorage
        function loadConfiguration() {
            const savedConfig = localStorage.getItem('iphoneBotConfig');
            if (savedConfig) {
                const config = JSON.parse(savedConfig);
                
                document.getElementById('firstName').value = config.firstName || 'test';
                document.getElementById('lastName').value = config.lastName || 'test';
                document.getElementById('email').value = config.email || 'test@example.com';
                document.getElementById('phone').value = config.phone || '1234567890';
                document.getElementById('streetAddress').value = config.streetAddress || '2934 NW 72nd Ave';
                document.getElementById('postalCode').value = config.postalCode || '33122';
                document.getElementById('cardNumber').value = config.cardNumber || '4111111111111111';
                document.getElementById('expirationDate').value = config.expirationDate || '0426';
                document.getElementById('securityCode').value = config.securityCode || '123';
                document.getElementById('targetUrl').value = config.targetUrl || '';
                document.getElementById('deliveryDate').value = config.deliveryDate || 'Sep 19';
                
                addLog('Configuration loaded from saved data', 'success');
            }
        }

        // Reset configuration
        function resetConfiguration() {
            localStorage.removeItem('iphoneBotConfig');
            document.getElementById('firstName').value = 'test';
            document.getElementById('lastName').value = 'test';
            document.getElementById('email').value = 'test@example.com';
            document.getElementById('phone').value = '1234567890';
            document.getElementById('streetAddress').value = '2934 NW 72nd Ave';
            document.getElementById('postalCode').value = '33122';
            document.getElementById('cardNumber').value = '4111111111111111';
            document.getElementById('expirationDate').value = '0426';
            document.getElementById('securityCode').value = '123';
            document.getElementById('targetUrl').value = '';
            document.getElementById('deliveryDate').value = 'Sep 19';
            
            addLog('Configuration reset to defaults', 'warning');
            updateStatus(false, 'Configuration Reset');
        }

        // Start the bot
        function startBot() {
            saveConfiguration();
            botRunning = true;
            localStorage.setItem('iphoneBotActive', 'true');
            addLog('Bot activation signal sent', 'success');
            updateStatus(true, 'Bot Starting...');
            
            // Signal to Tampermonkey script
            window.postMessage({ type: 'START_BOT', config: JSON.parse(localStorage.getItem('iphoneBotConfig')) }, '*');
        }

        // Stop the bot
        function stopBot() {
            botRunning = false;
            localStorage.setItem('iphoneBotActive', 'false');
            addLog('Bot deactivation signal sent', 'warning');
            updateStatus(false, 'Bot Stopped');
            
            // Signal to Tampermonkey script
            window.postMessage({ type: 'STOP_BOT' }, '*');
        }

        // Test connection
        function testConnection() {
            const targetUrl = document.getElementById('targetUrl').value;
            if (!targetUrl) {
                addLog('Please enter a target URL first', 'error');
                return;
            }
            
            addLog(`Testing connection to: ${targetUrl}`, 'info');
            
            // Test if URL is accessible
            fetch(targetUrl, { mode: 'no-cors' })
                .then(() => {
                    addLog('URL is accessible', 'success');
                    updateStatus(true, 'Connection Test Passed');
                })
                .catch((error) => {
                    addLog('URL test completed (CORS blocked - normal)', 'info');
                    updateStatus(true, 'URL Format Valid');
                });
        }

        // Manual start (backup method)
        function manualStart() {
            saveConfiguration();
            localStorage.setItem('iphoneBotActive', 'true');
            localStorage.setItem('iphoneBotManualStart', 'true');
            addLog('Manual start trigger set - refresh Apple page if needed', 'info');
            updateStatus(true, 'Manual Start Triggered');
            
            // Show instructions
            addLog('Go to Apple page and check console for [iPhone Bot] messages', 'info');
        }

        // Navigate to URL
        function navigateToUrl() {
            const targetUrl = document.getElementById('targetUrl').value;
            if (!targetUrl) {
                addLog('Please enter a target URL first', 'error');
                return;
            }
            
            addLog(`Navigating to: ${targetUrl}`, 'info');
            window.open(targetUrl, '_blank');
        }

        // Update status indicator
        function updateStatus(active, message) {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            if (active) {
                statusDot.classList.add('active');
                statusText.textContent = `Script Status: ${message}`;
            } else {
                statusDot.classList.remove('active');
                statusText.textContent = `Script Status: ${message}`;
            }
        }

        // Update current URL display
        function updateCurrentUrl() {
            const currentUrlElement = document.getElementById('currentUrl');
            currentUrlElement.textContent = `Current: ${window.location.href}`;
        }

        // Listen for messages from Tampermonkey script
        window.addEventListener('message', (event) => {
            console.log('Interface received message:', event.data);
            
            if (event.data.type === 'SCRIPT_STATUS') {
                updateStatus(event.data.active, event.data.message);
                addLog(`Script update: ${event.data.message}`, event.data.active ? 'success' : 'warning');
                
                if (event.data.url) {
                    document.getElementById('currentUrl').textContent = `Script URL: ${event.data.url}`;
                }
            }
        });

        // Initialize on page load
        window.addEventListener('load', () => {
            loadConfiguration();
            updateCurrentUrl();
            
            // Start checking for script status immediately
            checkScriptStatus();
            
            // Check if bot was previously active
            const wasActive = localStorage.getItem('iphoneBotActive') === 'true';
            if (wasActive) {
                addLog('Bot was previously active', 'info');
                updateStatus(true, 'Bot Previously Active');
            }
            
            addLog('Control panel ready - Looking for script...', 'success');
        });

        // Auto-save on input changes
        document.addEventListener('input', (event) => {
            if (event.target.type === 'text' || event.target.type === 'email' || event.target.type === 'tel' || event.target.type === 'url') {
                // Auto-save after 2 seconds of inactivity
                clearTimeout(window.autoSaveTimeout);
                window.autoSaveTimeout = setTimeout(() => {
                    saveConfiguration();
                }, 2000);
            }
        });
    </script>
</body>
</html>